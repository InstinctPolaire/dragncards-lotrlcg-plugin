{
    "automation": {
        "postLoadActionList": [
            ["DEFINE", "$LOADED_PLAYER_DECK", false],
            ["FOR_EACH_VAL", "$CARD_ID", "$GAME.loadedCardIds", [
                ["DEFINE", "$CARD", "$GAME.cardById.$CARD_ID"],
                ["COND", 
                    ["EQUAL", "$CARD.sides.A.type", "Hero"],
                    [
                        ["DEFINE", "$LOADED_PLAYER_DECK", true],
                        ["DEFINE", "$CONTROLLER", "$CARD.controller"],
                        ["INCREASE_VAL", "/playerData/$CONTROLLER/threat", "$CARD.sides.A.cost"],
                        ["LOG", "$PLAYER_N", " increased their threat by ", "$CARD.sides.A.cost", " (", "$CARD.sides.A.name", ")"]
                    ]
                ],
                ["COND",
                    ["EQUAL", "$CARD.groupId", ["JOIN_STRING", "$PLAYER_N", "Play1"]],
                    [
                        ["SET", "/cardById/$CARD_ID/deckGroupId", ["JOIN_STRING", "$PLAYER_N", "Deck"]],
                        ["SET", "/cardById/$CARD_ID/discardGroupId", ["JOIN_STRING", "$PLAYER_N", "Discard"]]
                    ],
                    ["IN_LIST", ["LIST", "sharedStagingArea", "ahredActiveLocation"], "$CARD.groupId"],
                    [
                        ["SET", "/cardById/$CARD_ID/deckGroupId", "sharedEncounterDeck"],
                        ["SET", "/cardById/$CARD_ID/discardGroupId", "sharedEncounterDiscard"]
                    ]
                ],
                ["COND", 
                    ["AND", ["EQUAL", "$CARD.sides.A.type", "Quest"], ["EQUAL", "$CARD.sides.A.cost", 1]],
                    [
                        ["MOVE_CARD", "$CARD_ID", "sharedMainQuest", 0],
                        ["LOG", "$PLAYER_N", " made ", "$CARD.sides.A.name", " the main quest."]
                    ]
                ]
            ]],
            ["DEFINE", "$PLAYER_N_HAND_GROUP_ID", ["JOIN_STRING", "$PLAYER_N", "Hand"]],
            ["COND",
                ["AND", "$LOADED_PLAYER_DECK", ["EQUAL", "$GAME.roundNumber", 0], ["EQUAL", ["LENGTH", "$GAME.groupById.$PLAYER_N_HAND_GROUP_ID.stackIds"], 0]],
                [
                    ["DRAW_CARD", 6],
                    ["LOG", "$PLAYER_N", " draws 6 cards."]
                ]
            ]
        ],
        "gameRules": [  
            { 
                "type": "trigger", 
                "listenTo": ["/cardById/*/inPlay"],
                "condition": ["AND", ["NOT", "$TARGET.inPlay"], ["PREV", "$TARGET.inPlay"], ["PREV", "$TARGET.committed"]],
                "then": [
                    ["DEFINE", "$QUESTING_STAT", "$GAME.questingStat"],
                    ["DEFINE", "$COMMITTED_VAL", ["PREV", ["ADD", "$TARGET.currentFace.$QUESTING_STAT", "$TARGET.tokens.$QUESTING_STAT"]]],
                    ["DECREASE_VAL", "/playerData/$TARGET.controller/willpower", "$COMMITTED_VAL"],
                    ["LOG", "$TARGET.controller", " lost ", "$COMMITTED_VAL", " ", "$QUESTING_STAT", " toward the quest."]
                ]
            }
        ],
        "cards": {
            "4c4cccd3-576a-41f1-8b6c-ba11b4cc3d4b": {
                "_comment": "Celeborn",
                "rules": [
                    {
                        "_comment": "Add tokens to Silvan allies that enter play if Celeborn is in play.",
                        "type": "trigger",
                        "listenTo": ["/cardById/*/inPlay"],
                        "condition": ["AND", "$THIS.inPlay", "$TARGET.inPlay", ["PREV", ["NOT", "$TARGET.inPlay"]], ["IN_STRING", "$TARGET.currentFace.traits", "Silvan."], ["EQUAL", "$TARGET.currentFace.type", "Ally"]],
                        "then": [
                            ["DEFINE", "$QUESTING_STAT", "$GAME.questingStat"],
                            ["DEFINE", "$COMMITTED_VAL", ["PREV", ["ADD", "$TARGET.currentFace.$QUESTING_STAT", "$TARGET.tokens.$QUESTING_STAT"]]],
                            ["INCREASE_VAL", "/cardById/$TARGET_ID/tokens/willpower", 1],
                            ["INCREASE_VAL", "/cardById/$TARGET_ID/tokens/attack", 1],
                            ["INCREASE_VAL", "/cardById/$TARGET_ID/tokens/defense", 1],
                            ["SET", "/cardById/$TARGET_ID/hasCelebornTokens", true],
                            ["LOG", "$TARGET.controller", " added 1 willpower, 1 attack, and 1 defense token to ", "$TARGET.currentFace.name", "."]
                        ]
                    },
                    {
                        "type": "trigger",
                        "listenTo": ["/roundNumber"],
                        "condition": ["TRUE"],
                        "then": ["FOR_EACH_KEY_VAL", "$CARD_ID", "$CARD", "$GAME.cardById", [
                            ["COND",
                                ["AND", "$CARD.hasCelebornTokens", "$CARD.inPlay"],
                                [
                                    ["DECREASE_VAL", "/cardById/$CARD_ID/tokens/willpower", 1],
                                    ["DECREASE_VAL", "/cardById/$CARD_ID/tokens/attack", 1],
                                    ["DECREASE_VAL", "/cardById/$CARD_ID/tokens/defense", 1],
                                    ["SET", "/cardById/$CARD_ID/hasCelebornTokens", false],
                                    ["LOG", "$CARD.controller", " removed 1 willpower, 1 attack, and 1 defense token from ", "$CARD.currentFace.name", "."]
                                ]
                            ]
                        ]]
                    }
                ]
            },
            "51223bd0-ffd1-11df-a976-0801206c9005": {
                "_comment": "Leadership Dain Ironfoot",
                "rules": [
                    {
                        "_comment": "Add tokens to Dwarf allies that enter play if Dain is in play.",
                        "type": "trigger",
                        "listenTo": ["/cardById/*/inPlay"],
                        "condition": ["AND", "$THIS.inPlay", "$TARGET.inPlay", ["PREV", ["NOT", "$TARGET.inPlay"]], ["IN_STRING", "$TARGET.currentFace.traits", "Dwarf."], ["NOT_EQUAL", "$THIS_ID", "$TARGET_ID"]],
                        "then": [
                            ["INCREASE_VAL", "/cardById/$TARGET_ID/tokens/willpower", 1],
                            ["INCREASE_VAL", "/cardById/$TARGET_ID/tokens/attack", 1],
                            ["LOG", "$TARGET.controller", " added 1 willpower and 1 attack to ", "$TARGET.currentFace.name", "."]
                        ]
                    },
                    { 
                        "_comment": "Add/remove tokens on Dwarf characters depending on whether Dain is ready or not.",
                        "type": "passive", 
                        "listenTo": ["/cardById/$THIS_ID/inPlay", "/cardById/$THIS_ID/currentSide", "/cardById/$THIS_ID/exhausted"],
                        "condition": [
                            "AND", 
                                "$THIS.inPlay",
                                ["EQUAL", "$THIS.currentSide", "A"],
                                ["EQUAL", "$THIS.exhausted", false]
                        ],
                        "onDo": [["FOR_EACH_KEY_VAL", "$CARD_ID", "$CARD", "$GAME.cardById", [
                            ["COND",
                                ["AND", "$CARD.inPlay", ["IN_STRING", "$CARD.currentFace.traits", "Dwarf."]],
                                [
                                    ["INCREASE_VAL", "/cardById/$CARD_ID/tokens/willpower", 1],
                                    ["INCREASE_VAL", "/cardById/$CARD_ID/tokens/attack", 1]
                                ]
                            ]]],
                            ["LOG", "$THIS.controller", " added 1 willpower and 1 attack to each Dwarf character in play."]
                        ],
                        "offDo": [["FOR_EACH_KEY_VAL", "$CARD_ID", "$CARD", "$GAME.cardById", [
                            ["COND",
                                ["AND", "$CARD.inPlay", ["OR", ["IN_STRING", "$CARD.currentFace.traits", "Dwarf."], ["EQUAL", "$CARD_ID", "$THIS_ID"]]],
                                [
                                    ["DECREASE_VAL", "/cardById/$CARD_ID/tokens/willpower", 1],
                                    ["DECREASE_VAL", "/cardById/$CARD_ID/tokens/attack", 1]
                                ]
                            ]]],
                            ["LOG", "$THIS.controller", " removed 1 willpower and 1 attack to each Dwarf character in play."]
                        ]
                    }
                ]
            }
        }
    }
}